<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare PDF Files</title>
    <!-- <link rel="stylesheet" href="/static/styles.css"> -->
    <link rel="stylesheet" href="/static/compare/style.css">
</head>
<body>
    <div class="container">
        <div class="top-left">
            <select id="clearDropdown" onchange="handleClear(this)">
                <option value="">Select Clear Action</option>
                <option value="clearMismatchedFiles">Clear Mismatched Folder</option>
                <option value="clearMatchedFiles">Clear Matched Folder</option>
            </select>
        </div>
        <div class="top-right">
            <select id="downloadDropdown" onchange="handleDownload(this)">
                <option value="">Select Download</option>
                <option value="/download_all_mismatched">Download All MM (ZIP)</option>
                <option value="/download_all_matched">Download All M (ZIP)</option>
            </select>
        </div>
        <h1>Compare PDF Files</h1>
        <nav class="centered-nav">
            <a href="/dashboard">Dashboard</a>
            <a href="/manual_compare">View Image Comparison</a>
        </nav>
        <form id="compareForm" method="POST" action="/compare_pdfs">
            <div>
                <label for="folder1">Baseline:</label>
                <input type="text" id="folder1" name="folder1" required>
                <button type="button" onclick="document.getElementById('folder1Input').click()">Browse</button>
                <input type="file" id="folder1Input" name="folder1Input" webkitdirectory style="display: none;" onchange="updatePath('folder1', this)">
            </div>
            <div>
                <label for="folder2">New Forms:</label>
                <input type="text" id="folder2" name="folder2" required>
                <button type="button" onclick="document.getElementById('folder2Input').click()">Browse</button>
                <input type="file" id="folder2Input" name="folder2Input" webkitdirectory style="display: none;" onchange="updatePath('folder2', this)">
            </div>
            <button type="submit" class="compare-btn">Compare</button>
        </form>
        <div class="message" id="message"></div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>File Name</th>
                        <th>Download</th>
                    </tr>
                </thead>
                <tbody id="matchList">
                    <!-- Mismatched files will be displayed here -->
                </tbody>
            </table>
        </div>
        <div class="pagination" id="pagination">
            <!-- Pagination links will be displayed here -->
        </div>
    </div>
    <script>
        function updatePath(inputId, inputElement) {
            let fullPath = '';
            if (inputElement.files.length > 0) {
                fullPath = inputElement.files[0].webkitRelativePath.split('/')[0];
                if (inputElement.files[0].webkitRelativePath.includes('\\')) {
                    fullPath = inputElement.files[0].webkitRelativePath.split('\\')[0];
                }
                document.getElementById(inputId).value = fullPath;
            }
        }

        function handleDownload(selectElement) {
            const url = selectElement.value;
            if (url) {
                window.location.href = url;
            }
        }

        function handleClear(selectElement) {
            const action = selectElement.value;
            if (action) {
                let url;
                if (action === 'clearMismatchedFiles') {
                    url = '/clear_mismatched_folder';
                } else if (action === 'clearMatchedFiles') {
                    url = '/clear_matched_folder';
                }
                if (url) {
                    let xhr = new XMLHttpRequest();
                    xhr.open('POST', url);
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    xhr.onload = () => {
                        let message = document.getElementById('message');
                        if (xhr.status === 200) {
                            let response = JSON.parse(xhr.responseText);
                            if (response.status === 'success') {
                                message.innerHTML = `<div class="notification-item"><span class="notification-text"><strong>${action.replace('clear', '').replace('Files', '')} directory cleared successfully.</strong></span></div>`;
                            } else {
                                message.innerHTML = `<div class="notification-item"><span class="notification-text"><strong>Failed to clear ${action.replace('clear', '').replace('Files', '')} directory.</strong></span></div>`;
                            }
                        } else {
                            message.innerHTML = `<div class="notification-item"><span class="notification-text"><strong>Request failed</strong></span></div>`;
                        }
                    };
                    xhr.send();
                }
            }
        }
    </script>
    <script src="/static/compare/compare.js"></script>
</body>
</html>
